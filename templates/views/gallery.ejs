<html lang="en">
  <head>
    <title>Gallery</title>
    <%- include('partials/heads_content') %>

    <link rel="stylesheet" href="/css/gallery.css" />

    <link rel="stylesheet" href="/css/footer.css" />

    <link rel="stylesheet" href="/css/lightbox.css" />
  </head>

  <body>
    <%- include('partials/header') %>

    <!--Carousel Wrapper-->
    <div
      id="carouselExampleIndicators"
      class="carousel slide carousel_css"
      data-ride="carousel"
    >
      <!-- <ol class="carousel-indicators">
      <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
      <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
      <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
    </ol> -->
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img
            src="/images/1.jpeg"
            class="d-block w-100 carousel_css"
            alt="..."
          />
        </div>
        <div class="carousel-item">
          <img
            src="/images/2.jpeg"
            class="d-block w-100 carousel_css"
            alt="..."
          />
        </div>
        <div class="carousel-item">
          <img
            src="/images/3.jpeg"
            class="d-block w-100 carousel_css"
            alt="..."
          />
        </div>
      </div>
      <a
        class="carousel-control-prev"
        href="#carouselExampleIndicators"
        role="button"
        data-slide="prev"
      >
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a
        class="carousel-control-next"
        href="#carouselExampleIndicators"
        role="button"
        data-slide="next"
      >
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
    <!--Carousel Wrapper Ends-->

    <!-- Gallery head description starts -->
    <div class="container mt-3">
      <div class="row mt-4 mt-xs-10">
        <div class="col-md-12 text-center">
          <h3 class="gallery_head">Atharva Events <b>Highlights</b></h3>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 col-md-offset-2 text-center mt-xs-10">
          <p class="gallery_paragraph">
            Here's a glimpse at some of the Major Highlights of Atharva Events!
          </p>
        </div>
      </div>
    </div>
    <!-- Gallery head description ends -->

    <div  class="d-flex justify-content-center">
      <div class="spinner-border loader" role="status">
        <span class="sr-only loader">Loading...</span>
      </div>
    </div>

    <p id="noImg" style="display: none; text-align: center; font-size: 25px; color:#777;">Images not available</p>
  
    <div class="gallery" id="gallery">
      <%if(typeof gallery !== 'undefined'){%> <%for(var i=0;i <
      gallery.length;i++){%>
      <div class="gallery-item">
        <div class="content">
          <img src="" class="loadImg" id="<%=i%>" />
        </div>
      </div>
      <%}%> <%}%>
    </div>

    <%- include('partials/footer') %>

    <script>
      //dynamic gallery script //
      if($(".loadImg").length === 0) {
        $(".loader").hide();
        $("#noImg").show()
      }
      $(".loadImg").on('load', function() {
        $(".loader").hide();
      })
      $(document).ready(async function () {

        function toBase64(arr) {
          //arr = new Uint8Array(arr) if it's an ArrayBuffer
          return btoa(
            arr.reduce((data, byte) => data + String.fromCharCode(byte), "")
          );
        }
        const galleryapifunction = async function () {
          const response = await fetch(
            "http://127.0.0.1:3000/admin/gallery/api",
            {
              headers: {
                "Content-Type": "application/json",
              },
            }
          );

          const myData = await response.json();

          for (let i = 0; i < myData["gallery"].length; i++) {
            var x = await document.getElementById(i);
            
            
            // x.setAttribute("width", "354");
            // x.setAttribute("height", "228");

            x.src =
              (await "data:image/jpeg;base64,") +
              toBase64(myData["gallery"][i].photo.data);
            // x.style.padding = "5px 3px";
          }
        };
        await galleryapifunction();
        //dynamic gallery script end //

        var gallery = document.querySelector("#gallery");
        var getVal = function (elem, style) {
          return parseInt(
            window.getComputedStyle(elem).getPropertyValue(style)
          );
        };
        var getHeight = function (item) {
          return item.querySelector(".content").getBoundingClientRect().height;
        };
        var resizeAll = function () {
          var altura = getVal(gallery, "grid-auto-rows");
          var gap = getVal(gallery, "grid-row-gap");
          gallery.querySelectorAll(".gallery-item").forEach(function (item) {
            var el = item;
            el.style.gridRowEnd =
              "span " + Math.ceil((getHeight(item) + gap) / (altura + gap));
          });
        };
        gallery.querySelectorAll("img").forEach(function (item) {
          // item.classList.add("byebye");
          // if (item.complete) {
          //   // console.log(item.src);
          // } else {
          item.addEventListener("load", function () {
            var altura = getVal(gallery, "grid-auto-rows");
            var gap = getVal(gallery, "grid-row-gap");
            var gitem = item.parentElement.parentElement;
            gitem.style.gridRowEnd =
              "span " + Math.ceil((getHeight(gitem) + gap) / (altura + gap));
            // item.classList.remove("byebye");
          });
          // }
        });
        window.addEventListener("resize", resizeAll);
        gallery.querySelectorAll(".gallery-item").forEach(function (item) {
          item.addEventListener("click", function () {
            item.classList.toggle("full");
          });
        });
      });
    </script>
  </body>
</html>
